<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Compute the MLEs and log-likelihood for the Gradient Boosting Machines (GBM) STAR model.
The STAR model requires a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator in this case is a GBM.
Standard function calls including fitted and residuals apply."><title>Fitting STAR Gradient Boosting Machines via EM algorithm — gbm_star • rSTAR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting STAR Gradient Boosting Machines via EM algorithm — gbm_star"><meta property="og:description" content="Compute the MLEs and log-likelihood for the Gradient Boosting Machines (GBM) STAR model.
The STAR model requires a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator in this case is a GBM.
Standard function calls including fitted and residuals apply."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSTAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/rSTAR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bking124/rSTAR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fitting STAR Gradient Boosting Machines via EM algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/bking124/rSTAR/blob/HEAD/R/STAR_frequentist.R" class="external-link"><code>R/STAR_frequentist.R</code></a></small>
      <div class="d-none name"><code>gbm_star.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute the MLEs and log-likelihood for the Gradient Boosting Machines (GBM) STAR model.
The STAR model requires a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator in this case is a GBM.
Standard function calls including <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></code> and <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></code> apply.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gbm_star</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  X.test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transformation <span class="op">=</span> <span class="st">"np"</span>,</span>
<span>  y_max <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  sd_init <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">10</span>,</span>
<span>  max_iters <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n.trees <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  interaction.depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  shrinkage <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  bag.fraction <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p><code>n x 1</code> vector of observed counts</p></dd>


<dt>X</dt>
<dd><p><code>n x p</code> matrix of predictors</p></dd>


<dt>X.test</dt>
<dd><p><code>m x p</code> matrix of out-of-sample predictors</p></dd>


<dt>transformation</dt>
<dd><p>transformation to use for the latent data; must be one of</p><ul><li><p>"identity" (identity transformation)</p></li>
<li><p>"log" (log transformation)</p></li>
<li><p>"sqrt" (square root transformation)</p></li>
<li><p>"np" (nonparametric transformation estimated from empirical CDF)</p></li>
<li><p>"pois" (transformation for moment-matched marginal Poisson CDF)</p></li>
<li><p>"neg-bin" (transformation for moment-matched marginal Negative Binomial CDF)</p></li>
<li><p>"box-cox" (box-cox transformation with learned parameter)</p></li>
</ul></dd>


<dt>y_max</dt>
<dd><p>a fixed and known upper bound for all observations; default is <code>Inf</code></p></dd>


<dt>sd_init</dt>
<dd><p>add random noise for EM algorithm initialization scaled by <code>sd_init</code>
times the Gaussian MLE standard deviation; default is 10</p></dd>


<dt>tol</dt>
<dd><p>tolerance for stopping the EM algorithm; default is 10^-10;</p></dd>


<dt>max_iters</dt>
<dd><p>maximum number of EM iterations before stopping; default is 1000</p></dd>


<dt>n.trees</dt>
<dd><p>Integer specifying the total number of trees to fit.
This is equivalent to the number of iterations and the number of basis functions in the additive expansion.
Default is 100.</p></dd>


<dt>interaction.depth</dt>
<dd><p>Integer specifying the maximum depth of each tree
(i.e., the highest level of variable interactions allowed).
A value of 1 implies an additive model, a value of 2 implies a model with up to 2-way interactions, etc.
Default is 1.</p></dd>


<dt>shrinkage</dt>
<dd><p>a shrinkage parameter applied to each tree in the expansion.
Also known as the learning rate or step-size reduction; 0.001 to 0.1 usually work, but a smaller learning rate typically requires more trees.
Default is 0.1.</p></dd>


<dt>bag.fraction</dt>
<dd><p>the fraction of the training set observations randomly selected to propose the next tree in the expansion.
This introduces randomnesses into the model fit. If bag.fraction &lt; 1 then running the same model twice will result in similar but different fits.
Default is 1 (for a deterministic prediction).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list with the following elements:</p><ul><li><p><code>fitted.values</code>: the fitted values at the MLEs (training)</p></li>
<li><p><code>fitted.values.test</code>: the fitted values at the MLEs (testing)</p></li>
<li><p><code>g.hat</code> a function containing the (known or estimated) transformation</p></li>
<li><p><code>sigma.hat</code> the MLE of the standard deviation</p></li>
<li><p><code>mu.hat</code> the MLE of the conditional mean (on the transformed scale)</p></li>
<li><p><code>z.hat</code> the estimated latent data (on the transformed scale) at the MLEs</p></li>
<li><p><code>residuals</code> the Dunn-Smyth residuals (randomized)</p></li>
<li><p><code>residuals_rep</code> the Dunn-Smyth residuals (randomized) for 10 replicates</p></li>
<li><p><code>logLik</code> the log-likelihood at the MLEs</p></li>
<li><p><code>logLik0</code> the log-likelihood at the MLEs for the *unrounded* initialization</p></li>
<li><p><code>lambda</code> the Box-Cox nonlinear parameter</p></li>
<li><p><code>gbmObj</code>: the object returned by gbm() at the MLEs</p></li>
<li><p>and other parameters that
(1) track the parameters across EM iterations and
(2) record the model specifications</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>STAR defines a count-valued probability model by
(1) specifying a Gaussian model for continuous *latent* data and
(2) connecting the latent data to the observed data via a
*transformation and rounding* operation. The Gaussian model in
this case is a GBM.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Infinite latent data values may occur when the transformed
Gaussian model is highly inadequate. In that case, the function returns
the *indices* of the data points with infinite latent values, which are
significant outliers under the model. Deletion of these indices and
re-running the model is one option, but care must be taken to ensure
that (i) it is appropriate to treat these observations as outliers and
(ii) the model is adequate for the remaining data points.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kowal, D. R., &amp; Wu, B. (2021).
Semiparametric count data regression for self‐reported mental health.
<em>Biometrics</em>. <a href="https://doi.org/10.1111/biom.13617" class="external-link">doi:10.1111/biom.13617</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate data with count-valued response y:</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">=</span> <span class="fu"><a href="simulate_nb_friedman.html">simulate_nb_friedman</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, p <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span>; <span class="va">X</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># EM algorithm for STAR (using the log-link)</span></span></span>
<span class="r-in"><span><span class="va">fit_em</span> <span class="op">=</span> <span class="fu">gbm_star</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>,</span></span>
<span class="r-in"><span>                 transformation <span class="op">=</span> <span class="st">'log'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate convergence:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">logLik_all</span>, type<span class="op">=</span><span class="st">'l'</span>, main <span class="op">=</span> <span class="st">'GBM-STAR-log'</span>, xlab <span class="op">=</span> <span class="st">'Iteration'</span>, ylab <span class="op">=</span> <span class="st">'log-lik'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gbm_star-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitted values:</span></span></span>
<span class="r-in"><span><span class="va">y_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y_hat</span>, <span class="va">y</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="gbm_star-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Residuals:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gbm_star-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gbm_star-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Log-likelihood at MLEs:</span></span></span>
<span class="r-in"><span><span class="va">fit_em</span><span class="op">$</span><span class="va">logLik</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -174.3085</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://bking124.github.io/" class="external-link">Brian King</a>, <a href="http://www.danielrkowal.com/" class="external-link">Daniel R. Kowal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

