<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Compute MLEs and log-likelihood for a generalized STAR model. The STAR model requires
a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator can be any least squares estimator, including nonlinear models.
Standard function calls including
coefficients(), fitted(), and residuals() apply."><title>Generalized EM estimation for STAR — genEM_star • countSTAR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generalized EM estimation for STAR — genEM_star"><meta property="og:description" content="Compute MLEs and log-likelihood for a generalized STAR model. The STAR model requires
a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator can be any least squares estimator, including nonlinear models.
Standard function calls including
coefficients(), fitted(), and residuals() apply."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">countSTAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/countSTAR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bking124/countSTAR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generalized EM estimation for STAR</h1>
      <small class="dont-index">Source: <a href="https://github.com/bking124/countSTAR/blob/HEAD/R/STAR_frequentist.R" class="external-link"><code>R/STAR_frequentist.R</code></a></small>
      <div class="d-none name"><code>genEM_star.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute MLEs and log-likelihood for a generalized STAR model. The STAR model requires
a *transformation* and an *estimation function* for the conditional mean
given observed data. The transformation can be known (e.g., log or sqrt) or unknown
(Box-Cox or estimated nonparametrically) for greater flexibility.
The estimator can be any least squares estimator, including nonlinear models.
Standard function calls including
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients()</a></code>, <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>, and <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> apply.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">genEM_star</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">estimator</span>,</span>
<span>  transformation <span class="op">=</span> <span class="st">"np"</span>,</span>
<span>  y_max <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  sd_init <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">10</span>,</span>
<span>  max_iters <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p><code>n x 1</code> vector of observed counts</p></dd>


<dt>estimator</dt>
<dd><p>a function that inputs data <code>y</code> and outputs a list with two elements:</p><ol><li><p>The fitted values <code>fitted.values</code></p></li>
<li><p>The parameter estimates <code>coefficients</code></p></li>
</ol></dd>


<dt>transformation</dt>
<dd><p>transformation to use for the latent data; must be one of</p><ul><li><p>"identity" (identity transformation)</p></li>
<li><p>"log" (log transformation)</p></li>
<li><p>"sqrt" (square root transformation)</p></li>
<li><p>"np" (nonparametric transformation estimated from empirical CDF)</p></li>
<li><p>"pois" (transformation for moment-matched marginal Poisson CDF)</p></li>
<li><p>"neg-bin" (transformation for moment-matched marginal Negative Binomial CDF)</p></li>
<li><p>"box-cox" (box-cox transformation with learned parameter)</p></li>
</ul></dd>


<dt>y_max</dt>
<dd><p>a fixed and known upper bound for all observations; default is <code>Inf</code></p></dd>


<dt>sd_init</dt>
<dd><p>add random noise for EM algorithm initialization scaled by <code>sd_init</code>
times the Gaussian MLE standard deviation; default is 10</p></dd>


<dt>tol</dt>
<dd><p>tolerance for stopping the EM algorithm; default is 10^-10;</p></dd>


<dt>max_iters</dt>
<dd><p>maximum number of EM iterations before stopping; default is 1000</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list with the following elements:</p><ul><li><p><code>coefficients</code> the MLEs of the coefficients</p></li>
<li><p><code>fitted.values</code> the fitted values at the MLEs</p></li>
<li><p><code>g.hat</code> a function containing the (known or estimated) transformation</p></li>
<li><p><code>sigma.hat</code> the MLE of the standard deviation</p></li>
<li><p><code>mu.hat</code> the MLE of the conditional mean (on the transformed scale)</p></li>
<li><p><code>z.hat</code> the estimated latent data (on the transformed scale) at the MLEs</p></li>
<li><p><code>residuals</code> the Dunn-Smyth residuals (randomized)</p></li>
<li><p><code>residuals_rep</code> the Dunn-Smyth residuals (randomized) for 10 replicates</p></li>
<li><p><code>logLik</code> the log-likelihood at the MLEs</p></li>
<li><p><code>logLik0</code> the log-likelihood at the MLEs for the *unrounded* initialization</p></li>
<li><p><code>lambda</code> the Box-Cox nonlinear parameter</p></li>
<li><p>and other parameters that
(1) track the parameters across EM iterations and
(2) record the model specifications</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>STAR defines a count-valued probability model by
(1) specifying a Gaussian model for continuous *latent* data and
(2) connecting the latent data to the observed data via a
*transformation and rounding* operation.</p>
<p>The expectation-maximization (EM) algorithm is used to produce
maximum likelihood estimators (MLEs) for the parameters defined in the
<code>estimator</code> function, such as linear regression coefficients,
which define the Gaussian model for the continuous latent data.
Fitted values (point predictions), residuals, and log-likelihood values
are also available. Inference for the estimators proceeds via classical maximum likelihood.
Initialization of the EM algorithm can be randomized to monitor convergence.
However, the log-likelihood is concave for all transformations (except 'box-cox'),
so global convergence is guaranteed.</p>
<p>There are several options for the transformation. First, the transformation
can belong to the *Box-Cox* family, which includes the known transformations
'identity', 'log', and 'sqrt', as well as a version in which the Box-Cox parameter
is estimated within the EM algorithm ('box-cox'). Second, the transformation
can be estimated (before model fitting) using the empirical distribution of the
data <code>y</code>. Options in this case include the empirical cumulative
distribution function (CDF), which is fully nonparametric ('np'), or the parametric
alternatives based on Poisson ('pois') or Negative-Binomial ('neg-bin')
distributions. For the parametric distributions, the parameters of the distribution
are estimated using moments (means and variances) of <code>y</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Infinite latent data values may occur when the transformed
Gaussian model is highly inadequate. In that case, the function returns
the *indices* of the data points with infinite latent values, which are
significant outliers under the model. Deletion of these indices and
re-running the model is one option, but care must be taken to ensure
that (i) it is appropriate to treat these observations as outliers and
(ii) the model is adequate for the remaining data points.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kowal, D. R., &amp; Wu, B. (2021).
Semiparametric count data regression for self‐reported mental health.
<em>Biometrics</em>. <a href="https://doi.org/10.1111/biom.13617" class="external-link">doi:10.1111/biom.13617</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate data with count-valued response y:</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">=</span> <span class="fu"><a href="simulate_nb_friedman.html">simulate_nb_friedman</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, p <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span>; <span class="va">X</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Select a transformation:</span></span></span>
<span class="r-in"><span><span class="va">transformation</span> <span class="op">=</span> <span class="st">'np'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example using GAM as underlying estimator (for illustration purposes only)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mgcv"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">fit_em</span> <span class="op">=</span> <span class="fu">genEM_star</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>                      estimator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      transformation <span class="op">=</span> <span class="va">transformation</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: mgcv</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: nlme</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is mgcv 1.8-42. For overview type 'help("mgcv-package")'.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitted coefficients:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)       s(X1).1       s(X1).2       s(X1).3       s(X1).4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3.272750e-03  4.083375e-03 -3.924544e-02  7.263968e-03 -6.201162e-02 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       s(X1).5       s(X1).6       s(X1).7       s(X1).8       s(X1).9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.290125e-02 -6.514381e-02 -1.108150e-02  3.255302e-01  3.335061e-01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       s(X2).1       s(X2).2       s(X2).3       s(X2).4       s(X2).5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -4.510772e-12 -3.538967e-12 -4.255166e-12 -6.304467e-12 -1.848074e-12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       s(X2).6       s(X2).7       s(X2).8       s(X2).9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6.650186e-12 -3.312680e-12  3.442796e-11  3.411655e-01 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitted values:</span></span></span>
<span class="r-in"><span><span class="va">y_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y_hat</span>, <span class="va">y</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="genEM_star-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Log-likelihood at MLEs:</span></span></span>
<span class="r-in"><span><span class="va">fit_em</span><span class="op">$</span><span class="va">logLik</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -206.6579</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://bking124.github.io/" class="external-link">Brian King</a>, <a href="http://www.danielrkowal.com/" class="external-link">Daniel R. Kowal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

