<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rSTAR">
<title>Getting Started with rSTAR • rSTAR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with rSTAR">
<meta property="og:description" content="rSTAR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSTAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/rSTAR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bking124/rSTAR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started with rSTAR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bking124/rSTAR/blob/HEAD/vignettes/rSTAR.Rmd" class="external-link"><code>vignettes/rSTAR.Rmd</code></a></small>
      <div class="d-none name"><code>rSTAR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>rSTAR</code> package implements a variety of methods to
analyze diverse integer-valued data, with a special focus on
count-valued data. The package functionality is broadly split into three
categories: Bayesian estimation of STAR models (<span class="citation">Kowal and Canale (<a href="#ref-Kowal_Canale_STAR" role="doc-biblioref">2020</a>)</span>, <span class="citation">Kowal and
Wu (<a href="#ref-Kowal_Wu_Conjugate" role="doc-biblioref">2021</a>)</span>), frequentist/classical estimation
(<span class="citation">Kowal and Wu (<a href="#ref-Kowal_Wu_Frequentist" role="doc-biblioref">2022</a>)</span>),
and time series analysis using warped Dynamic Linear Models (<span class="citation">King and Kowal (<a href="#ref-king2021warped" role="doc-biblioref">2021</a>)</span>).</p>
<p>We give a brief description of the STAR framework, before diving into
specific examples that show the <code>rSTAR</code> functionality.</p>
</div>
<div class="section level2">
<h2 id="simultaneous-transformation-and-rounding-star-models">Simultaneous Transformation and Rounding (STAR) Models<a class="anchor" aria-label="anchor" href="#simultaneous-transformation-and-rounding-star-models"></a>
</h2>
<p>STAR models build upon continuous data models to provide a <em>valid
integer-valued data-generating process</em>. An example STAR model for
linear regression is as follows: <span class="math display">\[\begin{align*}
y_i &amp;= \mbox{floor}(y_i^*) \\
z_i^* &amp;= \log(y_i^*) \\
z_i^* &amp;= x_i'\beta + \epsilon_i, \quad \epsilon_i
\stackrel{iid}{\sim}N(0, \sigma^2)
\end{align*}\]</span> The latent data <span class="math inline">\(y_i^*\)</span> act as a <em>continuous proxy</em>
for the count data <span class="math inline">\(y_i\)</span>, which is
easier to model yet has a simple mapping via the floor function to the
observed data. The latent data <span class="math inline">\(y_i^*\)</span> are transformed to <span class="math inline">\(z_i^*\)</span>, as in common practice, and modeled
using Gaussian linear regression. This model inherits the same structure
as before, but the data-generating process is now integer-valued.</p>
<p>More generally, STAR models are defined via a <em>rounding
operator</em> <span class="math inline">\(h\)</span>, a (known or
unknown) <em>transformation</em> <span class="math inline">\(g\)</span>,
and a <em>continuous data model</em> <span class="math inline">\(\Pi_\theta\)</span> with unknown parameters <span class="math inline">\(\theta\)</span>: <span class="math display">\[\begin{align*}
y &amp;= h(y^*) \quad \mbox{(rounding)}\\
z^* &amp;= g(y^*) \quad \mbox{(transformation)}\\
z^* &amp; \sim \Pi_\theta \quad \mbox{(model)}\\
\end{align*}\]</span> Importantly, STAR models are highly flexible
integer-valued processes, and provide the capability to model (i)
discrete data, (ii) zero-inflation, (iii) over- or under-dispersion, and
(iv) bounded or censored data.</p>
<p>We focus on conditionally Gaussian models of the form <span class="math display">\[
z^*(x) = \mu_\theta(x) + \epsilon(x), \quad \epsilon(x)
\stackrel{iid}{\sim}N(0, \sigma^2)
\]</span> where <span class="math inline">\(\mu_\theta(x)\)</span> is
the conditional expectation of the transformed latent data with unknown
parameters <span class="math inline">\(\theta\)</span>. Examples include
linear, additive, and tree-based regression models.</p>
</div>
<div class="section level2">
<h2 id="integer-valued-data-the-roaches-dataset">Integer-Valued Data: The Roaches Dataset<a class="anchor" aria-label="anchor" href="#integer-valued-data-the-roaches-dataset"></a>
</h2>
<p>As an example of complex count-valued data, consider the
<code>roaches</code> data from <span class="citation">Gelman and Hill
(<a href="#ref-Gelman_Hill_2006" role="doc-biblioref">2006</a>)</span>.
The response variable, <span class="math inline">\(y_i\)</span>, is the
number of roaches caught in traps in apartment <span class="math inline">\(i\)</span>, with <span class="math inline">\(i=1,\ldots, n = 262\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Source: http://mc-stan.org/rstanarm/articles/count.html</span></span>
<span><span class="co">#install.packages("rstanarm")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">roaches</span>, package<span class="op">=</span><span class="st">"rstanarm"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Roaches:</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">roaches</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="co"># Function to plot the point mass function:</span></span>
<span><span class="va">stickplot</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">js</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>; </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">js</span>, </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">js</span>, <span class="kw">function</span><span class="op">(</span><span class="va">js</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">js</span> <span class="op">==</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       type<span class="op">=</span><span class="st">'h'</span>, lwd<span class="op">=</span><span class="fl">2</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">stickplot</span><span class="op">(</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">'PMF: Roaches Data'</span>,</span>
<span>          xlab <span class="op">=</span> <span class="st">'Roaches'</span>, ylab <span class="op">=</span> <span class="st">'Probability mass'</span><span class="op">)</span></span></code></pre></div>
<p><img src="rSTAR_files/figure-html/roaches-1.png" width="700"></p>
<p>There are several notable features in the data:</p>
<ol style="list-style-type: decimal">
<li>Zero-inflation: 36% of the observations are zeros.</li>
<li>(Right-) Skewness, which is clear from the histogram and common for
(zero-inflated) count data.</li>
<li>Overdispersion: the sample mean is 26 and the sample variance is
2585.</li>
</ol>
<p>A pest management treatment was applied to a subset of 158
apartments, with the remaining 104 apartments receiving a control.
Additional data are available on the pre-treatment number of roaches,
whether the apartment building is restricted to elderly residents, and
the number of days for which the traps were exposed. We are interested
in modeling how the roach incidence varies with these predictors.</p>
</div>
<div class="section level2">
<h2 id="frequentist-inference-for-star-models">Frequentist inference for STAR models<a class="anchor" aria-label="anchor" href="#frequentist-inference-for-star-models"></a>
</h2>
<p>Frequentist (or classical) estimation and inference for STAR models
is provided by an EM algorithm. Sufficient for estimation is an
<code>estimator</code> function which solves the least squares (or
Gaussian maximum likelihood) problem associated with <span class="math inline">\(\mu_\theta\)</span>—or in other words, the
estimator that <em>would</em> be used for Gaussian or continuous data.
Specifically, <code>estimator</code> inputs data and outputs a list with
two elements: the estimated <code>coefficients</code> <span class="math inline">\(\hat \theta\)</span> and the
<code>fitted.values</code> <span class="math inline">\(\hat
\mu_\theta(x_i) = \mu_{\hat \theta}(x_i)\)</span>.</p>
<div class="section level3">
<h3 id="the-classical-linear-model">The Classical Linear Model<a class="anchor" aria-label="anchor" href="#the-classical-linear-model"></a>
</h3>
<p>For many applications, the STAR linear model is often the first
method to try. In <code>rSTAR</code>, the linear model is implemented
with the <code>lm_star</code> function, which aims to mimic the
functionality of <code>lm</code> by allowing users to input a formula.
Standard functions like <code>coef</code> and <code>fitted</code> can be
used on the output to extract coefficients and fitted values,
respectively.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bking124.github.io/rSTAR/">rSTAR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select a transformation:</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="st">'log'</span> <span class="co"># Log transformation</span></span>
<span><span class="co">#transformation = 'np' # Estimated transformation using empirical CDF</span></span>
<span></span>
<span><span class="co"># EM algorithm for STAR (using the log-link)</span></span>
<span><span class="va">fit_em</span> <span class="op">=</span> <span class="fu"><a href="../reference/lm_star.html">lm_star</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">roach1</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">senior</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exposure2</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">roaches</span>, transformation <span class="op">=</span> <span class="va">transformation</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Dimensions:</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>; <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fitted coefficients:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    (Intercept)         roach1      treatment         senior log(exposure2) </span></span>
<span><span class="co">#&gt;          1.260          0.015         -0.715         -0.912          0.560</span></span></code></pre></div>
<p>Here the <code>log</code> transformation was used, but other options
are available; see <code><a href="../reference/lm_star.html">?lm_star</a></code> for details.</p>
<p>Based on the fitted STAR linear model, we may further obtain
<em>confidence intervals</em> for the estimated coefficients using
<code>confint</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confidence interval for the j=2 column:</span></span>
<span><span class="va">j</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">ci_j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_em</span>, level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>        j <span class="op">=</span> <span class="va">j</span>,</span>
<span>        include_plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_j</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.012 0.019</span></span>
<span></span>
<span><span class="co"># Confidence for all columns:</span></span>
<span><span class="va">ci_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_em</span>, level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>        j <span class="op">=</span> <span class="va">j</span>,</span>
<span>        include_plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ci_all</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ci_all</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lower'</span>, <span class="st">'Upper'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_all</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 Lower  Upper</span></span>
<span><span class="co">#&gt; (Intercept)     0.775  1.721</span></span>
<span><span class="co">#&gt; roach1          0.012  0.019</span></span>
<span><span class="co">#&gt; treatment      -1.262 -0.176</span></span>
<span><span class="co">#&gt; senior         -1.526 -0.320</span></span>
<span><span class="co">#&gt; log(exposure2) -0.557  1.699</span></span></code></pre></div>
<p>Similarly, <em>p-values</em> are available using likelihood ratio
tests, which can be applied for individual coefficients,</p>
<p><span class="math display">\[
H_0: \beta_j= 0 \quad \mbox{vs} \quad H_1: \beta_j \ne 0
\]</span></p>
<p>or for joint sets of variables, analogous to a (partial) F-test:</p>
<p><span class="math display">\[
H_0: \beta_1=\ldots=\beta_p = 0, \quad \mbox{vs.} \quad H_1: \beta_j \ne
0 \mbox{ for some } j=1,\ldots,p
\]</span> P-values for all individual coefficients as well as the
p-value for <em>any</em> effects are computed with the
<code>pvals</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># P-values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/pvals.html">pvals</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        (Intercept)             roach1          treatment             senior </span></span>
<span><span class="co">#&gt;       1.705446e-06       2.980644e-16       1.027887e-02       3.090894e-03 </span></span>
<span><span class="co">#&gt;     log(exposure2) Any linear effects </span></span>
<span><span class="co">#&gt;       3.263341e-01       1.078663e-17</span></span></code></pre></div>
<p>Finally, we can get predictions at new data points (or the training
data) using <code>predict</code>, which actually outputs samples from
the (plug-in) predictive distribution at the MLEs. This output can then
be used to create prediction intervals if desired, or alternatively the
samples can be compared with the empirical PMF of <span class="math inline">\(y\)</span> using <code>plot_pmf</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Compute the predictive draws (just using observed points here)</span></span>
<span><span class="va">y_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using these draws, compute prediction intervals for STAR</span></span>
<span><span class="va">PI_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">y_pred</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot empirical PMf of y vs PMF from predictive draws</span></span>
<span><span class="fu"><a href="../reference/plot_pmf.html">plot_pmf</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">y_pred</span><span class="op">)</span></span></code></pre></div>
<p><img src="rSTAR_files/figure-html/predict-lm-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="machine-learning-models">Machine Learning Models<a class="anchor" aria-label="anchor" href="#machine-learning-models"></a>
</h3>
<p>In addition to the linear model, <code>rSTAR</code> also has
implementations for STAR models paired with more flexible regression
methods, in particular random forests and generalized boosted
machines.</p>
</div>
<div class="section level3">
<h3 id="a-generic-em-algorithm">A Generic EM Algorithm<a class="anchor" aria-label="anchor" href="#a-generic-em-algorithm"></a>
</h3>
<p>The EM algorithm updates the parameters until convergence to the
maximum likelihood estimators (MLEs), and is implemented in
<code>star_EM</code>:</p>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-inference-for-star-models">Bayesian inference for STAR models<a class="anchor" aria-label="anchor" href="#bayesian-inference-for-star-models"></a>
</h2>
<p>For a Bayesian model, STAR requires only an algorithm for
<em>initializing and sampling</em> from the posterior distribution under
a <em>continuous data model</em>. More specifically, posterior inference
under STAR is based on a Gibbs sampler, which augments the
aforementioned continuous sampler with a draw from <span class="math inline">\([z^* | y, \theta]\)</span>. When <span class="math inline">\(\Pi_\theta\)</span> is conditionally Gaussian,
<span class="math inline">\([z^* | y, \theta]\)</span> is a truncated
Gaussian distribution.</p>
<p>As an illustration, consider the Bayesian linear regression model
<span class="math display">\[\begin{align*}
z_i^* &amp;= x_i'\beta + \epsilon_i, \quad \epsilon_i
\stackrel{iid}{\sim}N(0, \sigma^2)\\
\beta_j &amp; \stackrel{iid}{\sim}N(0, \sigma_\beta^2), \quad
\sigma_\beta \sim \mbox{Uniform}(0, 10^4)
\end{align*}\]</span> With STAR and a log transformation, posterior
samples for <span class="math inline">\((\beta, \sigma_\beta,
\sigma)\)</span> are obtained using <code>star_MCMC</code> as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">roach1</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">senior</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exposure2</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">roaches</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dimensions:</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>; <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_mcmc</span> <span class="op">=</span> <span class="fu"><a href="../reference/genMCMC_star.html">genMCMC_star</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                          sample_params <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">params</span><span class="op">)</span></span>
<span>                            <span class="fu">rSTAR</span><span class="fu">:::</span><span class="fu"><a href="../reference/sample_lm_ridge.html">sample_lm_ridge</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">params</span><span class="op">)</span>,</span>
<span>                         init_params <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span>                           <span class="fu">rSTAR</span><span class="fu">:::</span><span class="fu"><a href="../reference/init_lm_ridge.html">init_lm_ridge</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">X</span><span class="op">)</span>,</span>
<span>                         transformation <span class="op">=</span> <span class="st">'log'</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>sample_params</code> computes a single draw of the
parameters <code>params</code> conditional on continuous data. Here, the
update is for Bayesian linear Gaussian regression, which samples from
the posterior of <span class="math inline">\((\beta, \sigma_\beta,
\sigma)\)</span> conditional on the continuous latent data <span class="math inline">\(z^*\)</span>. The function
<code>init_params</code> simply initializes the parameters
<code>params</code>. Posterior expectations and posterior credible
intervals are available as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior mean of each coefficient:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;  beta1  beta2  beta3  beta4  beta5 </span></span>
<span><span class="co">#&gt;  1.129  0.016 -0.603 -0.753  0.356</span></span>
<span></span>
<span><span class="co"># Credible intervals for regression coefficients</span></span>
<span><span class="va">ci_all_bayes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.beta</span>,</span>
<span>      <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename and print:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ci_all_bayes</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ci_all_bayes</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lower'</span>, <span class="st">'Upper'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_all_bayes</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 Lower  Upper</span></span>
<span><span class="co">#&gt; (Intercept)     0.591  1.628</span></span>
<span><span class="co">#&gt; roach1          0.012  0.019</span></span>
<span><span class="co">#&gt; treatment      -1.158 -0.046</span></span>
<span><span class="co">#&gt; senior         -1.386 -0.121</span></span>
<span><span class="co">#&gt; log(exposure2) -0.488  1.351</span></span></code></pre></div>
<p>We may further evaluate the model based on posterior diagnostics and
posterior predictive checks on the simulated versus observed proportion
of zeros:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior draws of the regression coefficients:</span></span>
<span><span class="va">post.coef</span> <span class="op">=</span> <span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.beta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="va">p</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">p</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># MCMC diagnostics:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">as.ts</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Trace plots'</span>, cex.lab <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="rSTAR_files/figure-html/diag-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># (Summary of) effective sample sizes across coefficients:</span></span>
<span><span class="fu"><a href="../reference/getEffSize.html">getEffSize</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    3667    3707    4146    4151    4590    4644</span></span>
<span></span>
<span><span class="co"># Posterior predictive check:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.pred</span>, <span class="fl">1</span>,</span>
<span>           <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Proportion of Zeros'</span>, xlab<span class="op">=</span><span class="st">''</span><span class="op">)</span>;</span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">4</span>, col <span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></code></pre></div>
<p><img src="rSTAR_files/figure-html/diag-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="additional-features-in-rstar">Additional features in <code>rSTAR</code><a class="anchor" aria-label="anchor" href="#additional-features-in-rstar"></a>
</h2>
<ul>
<li><p>A fixed upper bound, <code>y_max</code>, with <span class="math inline">\(y(x) \le \mbox{}\)</span> <code>y_max</code> for
all <span class="math inline">\(x\)</span></p></li>
<li><p>Residual diagnostics in <code>star_EM</code></p></li>
<li><p>Log-likelihood at MLEs in <code>star_EM</code> for model
comparison and information criteria (AIC or BIC)</p></li>
<li><p>Customized functions for STAR with gradient boosting
<code>gbm_star</code> and STAR with random forests
<code>randomForest_star</code></p></li>
<li><p>Fitted values <span class="math inline">\(\hat y(x) =
E\{y(x)\}\)</span> and posterior samples from <span class="math inline">\([\hat y(x) | y]\)</span> in
<code>star_MCMC</code></p></li>
<li><p>Samples from the <em>integer-valued</em> posterior predictive
distribution <span class="math inline">\([\tilde y(x) | y]\)</span> in
<code>star_MCMC</code>, where <span class="math inline">\(\tilde
y\)</span> denotes future or unobserved data</p></li>
<li><p>Customized samplers for Bayesian additive models
<code>sample_params_additive</code> and linear models with horseshoe
priors <code>sample_params_lm_hs</code></p></li>
<li><p>WAIC and pointwise log-likelihoods for (Bayesian) model
comparisons</p></li>
<li><p>A customized STAR model for Bayesian additive regression trees
(BART) <code>bart_star_MCMC</code></p></li>
<li><p>Posterior samplers for STAR with unknown and nonparametric
transformation <span class="math inline">\(g\)</span></p></li>
<li><p>Monte Carlo samplers for posterior and predictive inference with
linear regression and spline regression</p></li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Gelman_Hill_2006" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2006. <em>Data Analysis Using
Regression and Multilevel/Hierarchical Models</em>. Cambridge University
Press.
</div>
<div id="ref-king2021warped" class="csl-entry">
King, Brian, and Daniel Kowal. 2021. <span>“Warped Dynamic Linear Models
for Time Series of Counts.”</span> <em>arXiv Preprint
arXiv:2110.14790</em>.
</div>
<div id="ref-Kowal_Canale_STAR" class="csl-entry">
Kowal, Daniel, and Antonio Canale. 2020. <span>“Simultaneous
Transformation and Rounding (STAR) Models for Integer-Valued
Data.”</span> <em>Electronic Journal of Statistics</em> 14 (1). <a href="https://doi.org/10.1214/20-ejs1707" class="external-link">https://doi.org/10.1214/20-ejs1707</a>.
</div>
<div id="ref-Kowal_Wu_Conjugate" class="csl-entry">
Kowal, Daniel, and Bohan Wu. 2021. <span>“Semiparametric Discrete Data
Regression with Monte Carlo Inference and Prediction.”</span> <em>arXiv
Preprint arXiv:2110.12316</em>.
</div>
<div id="ref-Kowal_Wu_Frequentist" class="csl-entry">
———. 2022. <span>“Semiparametric Count Data Regression for Self‐reported
Mental Health.”</span> <em>Biometrics</em>, January. <a href="https://doi.org/10.1111/biom.13617" class="external-link">https://doi.org/10.1111/biom.13617</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://bking124.github.io/" class="external-link">Brian King</a>, <a href="http://www.danielrkowal.com/" class="external-link">Daniel R. Kowal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
