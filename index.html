<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="For Bayesian and classical inference and prediction with integer-valued data,
    Simultaneous Transformation and Rounding (STAR) Models provide a flexible, interpretable,
    and easy-to-use approach. STAR models the observed count data using a rounded 
    continuous data model and incorporates a transformation for greater flexibility.
    Implicitly, STAR formalizes the commonly-applied yet incoherent procedure of 
    (i) transforming integer-valued data and subsequently 
    (ii) modeling the transformed data using Gaussian models. 
    STAR is well-defined for integer-valued data, 
    which is reflected in predictive accuracy, and is designed to account for 
    zero-inflation, bounded or censored data, and over- or underdispersion. 
    Importantly, STAR is easy to combine with existing MCMC or point estimation
    methods for continuous data, which allows seamless adaptation of continuous data
    models (such as linear regressions, additive models, BART, random forests,
    and gradient boosting machines) for integer-valued data. The package also includes several
    methods for modeling count-valued time series data, namely via warped Dynamic Linear Models.">
<title>Modeling Integer-Valued Data  via Simultaneous Transformation and Rounding (STAR) • rSTAR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Modeling Integer-Valued Data  via Simultaneous Transformation and Rounding (STAR)">
<meta property="og:description" content="For Bayesian and classical inference and prediction with integer-valued data,
    Simultaneous Transformation and Rounding (STAR) Models provide a flexible, interpretable,
    and easy-to-use approach. STAR models the observed count data using a rounded 
    continuous data model and incorporates a transformation for greater flexibility.
    Implicitly, STAR formalizes the commonly-applied yet incoherent procedure of 
    (i) transforming integer-valued data and subsequently 
    (ii) modeling the transformed data using Gaussian models. 
    STAR is well-defined for integer-valued data, 
    which is reflected in predictive accuracy, and is designed to account for 
    zero-inflation, bounded or censored data, and over- or underdispersion. 
    Importantly, STAR is easy to combine with existing MCMC or point estimation
    methods for continuous data, which allows seamless adaptation of continuous data
    models (such as linear regressions, additive models, BART, random forests,
    and gradient boosting machines) for integer-valued data. The package also includes several
    methods for modeling count-valued time series data, namely via warped Dynamic Linear Models.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rSTAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/getting-started.html">Getting Started with rSTAR</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="star-simultaneous-transformation-and-rounding-for-modeling-integer-valued-data">STAR: Simultaneous Transformation and Rounding for Modeling Integer-Valued Data<a class="anchor" aria-label="anchor" href="#star-simultaneous-transformation-and-rounding-for-modeling-integer-valued-data"></a>
</h1></div>
<div class="section level2">
<h2 id="background-integer-valued-data">Background: integer-valued data<a class="anchor" aria-label="anchor" href="#background-integer-valued-data"></a>
</h2>
<p>Integer-valued or count data are common in many fields. Frequently, integer-valued data are observed jointly with predictors, over time intervals, or across spatial locations. Integer-valued data also exhibit a variety of distributional features, including zero-inflation, skewness, over- and underdispersion, and in some cases may be bounded or censored. Flexible and interpretable models for <em>integer-valued processes</em> are therefore highly useful in practice.</p>
<p>As an illustration, consider the <code>roaches</code> data from Gelman and Hill (2006). The response variable, <span class="math inline"><em>y</em><sub><em>i</em></sub></span>, is the number of roaches caught in traps in apartment <span class="math inline"><em>i</em></span>, with <span class="math inline"><em>i</em> = 1, …, <em>n</em> = 262</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Source: http://mc-stan.org/rstanarm/articles/count.html</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">roaches</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Roaches:</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">roaches</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="co"># Function to plot the point mass function:</span></span>
<span><span class="va">stickplot</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">js</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>; </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">js</span>, </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">js</span>, <span class="kw">function</span><span class="op">(</span><span class="va">js</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">js</span> <span class="op">==</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       type<span class="op">=</span><span class="st">'h'</span>, lwd<span class="op">=</span><span class="fl">2</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">stickplot</span><span class="op">(</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">'PMF: Roaches Data'</span>,</span>
<span>          xlab <span class="op">=</span> <span class="st">'Roaches'</span>, ylab <span class="op">=</span> <span class="st">'Probability mass'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/roaches-1.png"><!-- --></p>
<p>There are several notable features in the data:</p>
<ol style="list-style-type: decimal">
<li>Zero-inflation: 36% of the observations are zeros.</li>
<li>(Right-) Skewness, which is clear from the histogram and common for (zero-inflated) count data.</li>
<li>Overdispersion: the sample mean is 26 and the sample variance is
<ol start="2585" style="list-style-type: decimal"><li>
</li></ol>
</li>
</ol>
<p>A pest management treatment was applied to a subset of 158 apartments, with the remaining 104 apartments receiving a control. Additional data are available on the pre-treatment number of roaches, whether the apartment building is restricted to elderly residents, and the number of days for which the traps were exposed. We are interested in modeling how the roach incidence varies with these predictors.</p>
<p>There are two main modeling frameworks for this kind of data:</p>
<ol style="list-style-type: decimal">
<li><p><em>Poisson and extensions</em>: the Poisson distribution is a valid count-valued distribution, and may incorporate predictions within a generalized linear modeling (GLM) framework. However, the Poisson distribution has limited modeling flexibility, which restricts practical utility in many applications. Extensions such as the zero-inflated Poisson, the negative-binomial, and the Conway-Maxwell distribuiton seek to enhance flexibility by adding parameters. While successful in some cases, these approaches require estimation of each additional parameter, which presents challenges especially in the presence of predictors or other (temporal or spatial) dependence.</p></li>
<li><p><em>Transformed Gaussian</em>: in applied settings, it is perhaps more common to simply ignore the discrete nature of the data and apply continuous data models. For example, one might consider the transformed regression model</p></li>
</ol>
<p><span class="math display">$$
z_i = \log(y_i + 1), \quad
y_i = x_i'\beta + \epsilon_i, \quad \epsilon_i \stackrel{iid}{\sim}N(0, \sigma^2)
$$</span> The transformation helps model the skewness often found in count data, while the regression model incorporates a simple and well-known continuous data model. However, this approach has two major flaws: (i) the transformation <span class="math inline"><em>z</em><sub><em>i</em></sub> = log (<em>y</em><sub><em>i</em></sub>+1)</span> requires the inclusion of an artificial constant to accommodate <span class="math inline"><em>y</em><sub><em>i</em></sub> = 0</span>, which is arbitrary and may introduce bias, and more importantly (ii) the implied data-generating process is <em>not</em> integer-valued, which induces a fundamental discrepancy between the data and the model.</p>
</div>
<div class="section level2">
<h2 id="simultaneous-transformation-and-rounding-star-models">Simultaneous Transformation and Rounding (STAR) Models<a class="anchor" aria-label="anchor" href="#simultaneous-transformation-and-rounding-star-models"></a>
</h2>
<p>STAR models build upon the continuous data model to provide a <em>valid integer-valued data-generating process</em>. An example STAR model for linear regression is as follows: The latent data <span class="math inline"><em>y</em><sub><em>i</em></sub><sup>*</sup></span> act as a <em>continuous proxy</em> for the count data <span class="math inline"><em>y</em><sub><em>i</em></sub></span>, which is easier to model yet has a simple mapping via the floor function to the observed data. The latent data <span class="math inline"><em>y</em><sub><em>i</em></sub><sup>*</sup></span> are transformed to <span class="math inline"><em>z</em><sub><em>i</em></sub><sup>*</sup></span>, as in common practice, and modeled using Gaussian linear regression. This model inherits the same structure as before, but the data-generating process is now integer-valued.</p>
<p>More generally, STAR models are defined via a <em>rounding operator</em> <span class="math inline"><em>h</em></span>, a (known or unknown) <em>transformation</em> <span class="math inline"><em>g</em></span>, and a <em>continuous data model</em> <span class="math inline"><em>Π</em><sub><em>θ</em></sub></span> with unknown parameters <span class="math inline"><em>θ</em></span>: Importantly, STAR models are highly flexible integer-valued processes, and provide the capability to model (i) discrete data, (ii) zero-inflation, (iii) over- or under-dispersion, and (iv) bounded or censored data.</p>
<p>We focus on conditionally Gaussian models of the form <span class="math display">$$
z^*(x) = \mu_\theta(x) + \epsilon(x), \quad \epsilon(x) \stackrel{iid}{\sim}N(0, \sigma^2)
$$</span> where <span class="math inline"><em>μ</em><sub><em>θ</em></sub>(<em>x</em>)</span> is the conditional expectation of the transformed latent data with unknown parameters <span class="math inline"><em>θ</em></span>. Examples include linear, additive, and tree-based regression models.</p>
<p>Estimation, inference, and prediction for STAR are available for both <em>Bayesian</em> and <em>frequentist</em> models. Implementation in both cases is provided in the <code>rSTAR</code> package.</p>
</div>
<div class="section level2">
<h2 id="frequentist-inference-for-star-models">Frequentist inference for STAR models<a class="anchor" aria-label="anchor" href="#frequentist-inference-for-star-models"></a>
</h2>
<p>Frequentist (or classical) estimation and inference for STAR models is provided by an EM algorithm. Sufficient for estimation is an <code>estimator</code> function which solves the least squares (or Gaussian maximum likelihood) problem associated with <span class="math inline"><em>μ</em><sub><em>θ</em></sub></span>—or in other words, the estimator that <em>would</em> be used for Gaussian or continuous data. Specifically, <code>estimator</code> inputs data and outputs a list with two elements: the estimated <code>coefficients</code> <span class="math inline"><em>θ̂</em></span> and the <code>fitted.values</code> <span class="math inline"><em>μ̂</em><sub><em>θ</em></sub>(<em>x</em><sub><em>i</em></sub>) = <em>μ</em><sub><em>θ̂</em></sub>(<em>x</em><sub><em>i</em></sub>)</span>. The EM algorithm updates the parameters until convergence to the maximum likelihood estimators (MLEs), and is implemented in <code>star_EM</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select a transformation:</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="st">'log'</span> <span class="co"># Log transformation</span></span>
<span><span class="co"># transformation = 'np' # Estimated transformation using empirical CDF</span></span>
<span></span>
<span><span class="co"># EM algorithm for STAR (using the log-link)</span></span>
<span><span class="va">fit_em</span> <span class="op">=</span> <span class="fu"><a href="reference/lm_star.html">lm_star</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">roach1</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">senior</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exposure2</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">roaches</span>, transformation <span class="op">=</span> <span class="va">transformation</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Dimensions:</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>; <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fitted coefficients:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    (Intercept)         roach1      treatment         senior log(exposure2) </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">##          1.260          0.015         -0.715         -0.912          0.560</span></span></code></pre></div>
<p>Here the <code>log</code> transformation was used, but other options are available; see <code><a href="reference/lm_star.html">?lm_star</a></code> for details.</p>
<p>Based on the fitted STAR model, we may further obtain <em>confidence intervals</em> for the estimated coefficients using <code>confint</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confidence interval for the j=2 column:</span></span>
<span><span class="va">j</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">ci_j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_em</span>, level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>        j <span class="op">=</span> <span class="va">j</span>,</span>
<span>        include_plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_j</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.012 0.019</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confidence for all columns:</span></span>
<span><span class="va">ci_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_em</span>, level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>        j <span class="op">=</span> <span class="va">j</span>,</span>
<span>        include_plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ci_all</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ci_all</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lower'</span>, <span class="st">'Upper'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_all</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Lower  Upper</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)     0.792  1.728</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## roach1          0.012  0.019</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## treatment      -1.262 -0.176</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## senior         -1.526 -0.312</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## log(exposure2) -0.557  1.700</span></span></code></pre></div>
<p>Similarly, <em>p-values</em> are available using likelihood ratio tests, which can be applied for individual coefficients,</p>
<p><span class="math display"><em>H</em><sub>0</sub> : <em>β</em><sub><em>j</em></sub> = 0  vs  <em>H</em><sub>1</sub> : <em>β</em><sub><em>j</em></sub> ≠ 0</span></p>
<p>or for joint sets of variables, analogous to a (partial) F-test:</p>
<p><span class="math display"><em>H</em><sub>0</sub> : <em>β</em><sub>1</sub> = … = <em>β</em><sub><em>p</em></sub> = 0,  vs.  <em>H</em><sub>1</sub> : <em>β</em><sub><em>j</em></sub> ≠ 0 for some <em>j</em> = 1, …, <em>p</em></span></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># p-value for *any* effects</span></span>
<span><span class="co"># Note that the null model estimator *does not* include any X:</span></span>
<span><span class="co"># P-values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="reference/pvals.html">pvals</a></span><span class="op">(</span><span class="va">fit_em</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        (Intercept)             roach1          treatment             senior </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">##       1.705446e-06       2.980645e-16       1.027886e-02       3.090894e-03 </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     log(exposure2) Any linear effects </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       3.263339e-01       1.078662e-17</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bayesian-inference-for-star-models">Bayesian inference for STAR models<a class="anchor" aria-label="anchor" href="#bayesian-inference-for-star-models"></a>
</h2>
<p>For a Bayesian model, STAR requires only an algorithm for <em>initializing and sampling</em> from the posterior distribution under a <em>continuous data model</em>. More specifically, posterior inference under STAR is based on a Gibbs sampler, which augments the aforementioned continuous sampler with a draw from <span class="math inline">[<em>z</em><sup>*</sup>|<em>y</em>,<em>θ</em>]</span>. When <span class="math inline"><em>Π</em><sub><em>θ</em></sub></span> is conditionally Gaussian, <span class="math inline">[<em>z</em><sup>*</sup>|<em>y</em>,<em>θ</em>]</span> is a truncated Gaussian distribution.</p>
<p>As an illustration, consider the Bayesian linear regression model With STAR and a log transformation, posterior samples for <span class="math inline">(<em>β</em>,<em>σ</em><sub><em>β</em></sub>,<em>σ</em>)</span> are obtained using <code>star_MCMC</code> as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">roach1</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">senior</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exposure2</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">roaches</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dimensions:</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>; <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_mcmc</span> <span class="op">=</span> <span class="fu">star_MCMC</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                          sample_params <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">params</span><span class="op">)</span></span>
<span>                            <span class="fu"><a href="reference/sample_params_lm.html">sample_params_lm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">params</span><span class="op">)</span>,</span>
<span>                         init_params <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span>                           <span class="fu"><a href="reference/init_params_lm.html">init_params_lm</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">X</span><span class="op">)</span>,</span>
<span>                         transformation <span class="op">=</span> <span class="st">'log'</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>sample_params</code> computes a single draw of the parameters <code>params</code> conditional on continuous data. Here, the update is for Bayesian linear Gaussian regression, which samples from the posterior of <span class="math inline">(<em>β</em>,<em>σ</em><sub><em>β</em></sub>,<em>σ</em>)</span> conditional on the continuous latent data <span class="math inline"><em>z</em><sup>*</sup></span>. The function <code>init_params</code> simply initializes the parameters <code>params</code>. Posterior expectations and posterior credible intervals are available as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior mean of each coefficient:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">##       beta1       beta2       beta3       beta4       beta5 sigma_beta1 </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">##       1.126       0.015      -0.597      -0.744       0.337    1000.000 </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma_beta2 sigma_beta3 sigma_beta4 sigma_beta5 </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       0.915       0.915       0.915       0.915</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Credible intervals for regression coefficients</span></span>
<span><span class="va">ci_all_bayes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.coefficients</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>,</span>
<span>      <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename and print:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ci_all_bayes</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ci_all_bayes</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lower'</span>, <span class="st">'Upper'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_all_bayes</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Lower  Upper</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)     0.580  1.632</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">## roach1          0.012  0.019</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## treatment      -1.154 -0.043</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">## senior         -1.396 -0.085</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## log(exposure2) -0.497  1.327</span></span></code></pre></div>
<p>We may further evaluate the model based on posterior diagnostics and posterior predictive checks on the simulated versus observed proportion of zeros:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior draws of the regression coefficients:</span></span>
<span><span class="va">post.coef</span> <span class="op">=</span> <span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.coefficients</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="va">p</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">p</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># MCMC diagnostics:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">as.ts</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Trace plots'</span>, cex.lab <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/diag-1.png"><!-- --></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (Summary of) effective sample sizes across coefficients:</span></span>
<span><span class="fu"><a href="reference/getEffSize.html">getEffSize</a></span><span class="op">(</span><span class="va">post.coef</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    2981    3404    4100    3987    4682    4767</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior predictive check:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fit_mcmc</span><span class="op">$</span><span class="va">post.pred</span>, <span class="fl">1</span>,</span>
<span>           <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Proportion of Zeros'</span>, xlab<span class="op">=</span><span class="st">''</span><span class="op">)</span>;</span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">4</span>, col <span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/diag-2.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="additional-features-in-rstar">Additional features in <code>rSTAR</code>
<a class="anchor" aria-label="anchor" href="#additional-features-in-rstar"></a>
</h2>
<ul>
<li><p>A fixed upper bound, <code>y_max</code>, with <span class="math inline"><em>y</em>(<em>x</em>) ≤ </span> <code>y_max</code> for all <span class="math inline"><em>x</em></span></p></li>
<li><p>Residual diagnostics in <code>star_EM</code></p></li>
<li><p>Log-likelihood at MLEs in <code>star_EM</code> for model comparison and information criteria (AIC or BIC)</p></li>
<li><p>Customized functions for STAR with gradient boosting <code>gbm_star</code> and STAR with random forests <code>randomForest_star</code></p></li>
<li><p>Fitted values <span class="math inline"><em>ŷ</em>(<em>x</em>) = <em>E</em>{<em>y</em>(<em>x</em>)}</span> and posterior samples from <span class="math inline">[<em>ŷ</em>(<em>x</em>)|<em>y</em>]</span> in <code>star_MCMC</code></p></li>
<li><p>Samples from the <em>integer-valued</em> posterior predictive distribution <span class="math inline">[<em>ỹ</em>(<em>x</em>)|<em>y</em>]</span> in <code>star_MCMC</code>, where <span class="math inline"><em>ỹ</em></span> denotes future or unobserved data</p></li>
<li><p>Customized samplers for Bayesian additive models <code>sample_params_additive</code> and linear models with horseshoe priors <code>sample_params_lm_hs</code></p></li>
<li><p>WAIC and pointwise log-likelihoods for (Bayesian) model comparisons</p></li>
<li><p>A customized STAR model for Bayesian additive regression trees (BART) <code>bart_star_MCMC</code></p></li>
<li><p>Posterior samplers for STAR with unknown and nonparametric transformation <span class="math inline"><em>g</em></span></p></li>
<li><p>Monte Carlo samplers for posterior and predictive inference with linear regression and spline regression</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2" class="external-link">GPL-2</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rSTAR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://bking124.github.io/" class="external-link">Brian King</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>
<a href="http://www.danielrkowal.com/" class="external-link">Daniel R. Kowal</a> <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://bking124.github.io/" class="external-link">Brian King</a>, <a href="http://www.danielrkowal.com/" class="external-link">Daniel R. Kowal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
